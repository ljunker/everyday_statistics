<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Everyday Statistics</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body data-api-key="{{ api_key }}">
<div class="container py-5">
  <h1 class="mb-4">Admin Panel</h1>
  <a href="/" class="btn btn-secondary mb-4">‚¨Ö Back to Dashboard</a>

  <h3>üì¶ Backup Database</h3>
  <p>Export all events & mappings as JSON.</p>
  <a href="/backup/export" target="_blank" class="btn btn-outline-primary mb-4">
    ‚¨áÔ∏è Download Backup
  </a>

  <h3 class="mt-5">‚ôªÔ∏è Restore Database</h3>
  <p>Upload a backup JSON file. This will delete all current data!</p>
  <form id="importForm" class="mb-4">
    <input type="file" id="importFile" accept="application/json" class="form-control mb-2">
    <button type="submit" class="btn btn-danger">Restore Database</button>
  </form>

  <h3 class="mt-5">üë§ Users</h3>
  <p>Coming soon: manage per-user API keys!</p>
</div>

<script>
  const apiKey = document.body.dataset.apiKey;

  document.getElementById('importForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const file = document.getElementById('importFile').files[0];
    if (!file) {
      alert('Please select a file.');
      return;
    }

    if (!confirm('‚ö†Ô∏è Are you sure? This will delete all existing data!')) return;

    const text = await file.text();

    const res = await fetch('/backup/import', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-API-KEY': apiKey
      },
      body: text
    });

    if (res.ok) {
      alert('‚úÖ Database restored successfully!');
    } else {
      alert('‚ùå Failed to restore. Check your JSON file.');
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
